<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport"    content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author"      content="David & Yasen">
	<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Expires" content="0" />
	
	<title>The Traveler Bulgaria</title>

	<link rel="shortcut icon" href="assets/images/gt_favicon.png">
	
	<link rel="stylesheet" media="screen" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,700">
	<link rel="stylesheet" href="assets/css/bootstrap.min.css">
	<link rel="stylesheet" href="assets/css/font-awesome.min.css">

	<!-- Custom styles for our template -->
	<link rel="stylesheet" href="assets/css/bootstrap-theme.css" media="screen" >
	<link rel="stylesheet" href="assets/css/main.css">
	<link rel="stylesheet" href="assets/css/search.css">

	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
	<script src="assets/js/html5shiv.js"></script>
	<script src="assets/js/respond.min.js"></script>
	<![endif]-->

</head>

<body onLoad="initialize()">
	<!-- Fixed navbar -->
	
	
	<div class="navbar navbar-inverse navbar-fixed-top headroom" >
		<div class="container">
			<div class="navbar-header">
				<!-- Button for smallest screens -->
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"><span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button>
				<a class="navbar-brand" href="index.html"><img src="assets/images/logo4.png" alt="The Traveler Bulgaria"></a>
			</div>
			<div class="navbar-collapse collapse">
				<ul class="nav navbar-nav pull-right">
				<li>
					<div class="button_box2">
						<form class="form-wrapper-2 cf" action="SearchResults.html">
							<input type="text" name="search" placeholder="Search here..." required>
							<button type="submit">Search</button>
						</form>
					</div>
					</li>
					<li><a href="index.html">Home</a></li>					
					<li><a href="AllDestinations.html">Destinations</a></li>
					<li><a href="NewsFeed.html">News Feed</a></li>
					<li><a class="btnc" onclick="logOut()">Logout</a></li>
					<li><a class="btnc" href="profile.html">PROFILE</a></li>
				</ul>
			</div><!--/.nav-collapse -->
		</div>
	</div> 
	<!-- /.navbar -->

	<header id="head" class="secondary"></header>

	<!-- container -->
	<div class="container">

		<ol class="breadcrumb">
			<li><a href="index.html">Home</a></li>
			<li class="active">Add Destination</li>
		</ol>

		<div class="row">
			
			<!-- Article main content -->
			<article class="col-sm-9 maincontent">
				<header class="page-header">
					<h1 class="page-title">New Destination</h1>
				</header>
				
				<p>
					Share your experience and photos of a destination you have visited.
				</p>
				<br>
					<form id="addDestForm" action="javascript:add()" enctype="multipart/form-data">
    					<div class="row">
        					<div class="col-sm-4">
            					<input  id="name" name="name" class="form-control" type="text" placeholder="Name" maxlength="64" required>
       				 		</div>
       				 		<div class="col-sm-4">
	         				   <input id="lattitude" name="lattitude" class="form-control" type="text" placeholder="Lattitude" maxlength="20" required>
	      					</div>
        					<div class="col-sm-4">
           						 <input id="longitude" name="longitude" class="form-control" type="text" placeholder="Longitude" maxlength="20" required>
        					</div>
    					</div>
   					 	<br>
    					<div class="row">
     				 	  <div class="col-sm-12">
           				 <textarea id="description" name="description" placeholder="Type your experience here" class="form-control" rows="9" maxlength="500" required></textarea>
        				  </div>
    					</div>
    					<br>
		   				 <div class="row">
		       			 	<div class="col-sm-6">
		        			    <input id="mainPicture" name="mainPicture" type="file" class="form-control" placeholder="Insert Picture" accept="image/*" required="">
		       				</div>
		       				<div class="col-sm-6">
		       					<input id="category" name="category" class="form-control" list="categories" placeholder="Set Category" required="">
		       					<datalist id="categories">
		       						<option value="MOUNTAINS">
		       						<option value="BEACHES">
		       						<option value="CAVES">
		       						<option value="RIVERS">
		       						<option value="FORESTS">
		       						<option value="WATERFALLS">
		       						<option value="LAKES">
		       						<option value="CITIES">
		       						<option value="RURAL_AREAS">
		       						<option value="CAMPSITES">
		       					</datalist>
		        			    
		       				</div>
						    <hr>
						    </div> 
						<div class="row">
		      				<div class="col-sm-12">
      			     		 	<input class="btn btn-action" type="submit" value="Add Destination">       			 		
    						</div>
    						<div class="row">
		     				   <div class="col-sm-12" id="message">
		     				   
		           			 </div>       			
		    			</div>
    					</div>
		    			
   					 	<div class="row" id="map" style="width:100% height:100%"></div>
					</form>
			</article>
			<!-- /Article -->
			

		</div>
	</div>	<!-- /container -->
	
	

	<footer id="footer" class="top-space">
			<div class="footer2">
            <div class="container">
                <div class="row">
                    
                    <div class="col-md-6 widget">
                        <div class="widget-body">
                            <p class="simplenav">
                                <a href="#">Home</a> | 
                                <a href="SectionUnderConstructionPage.html">About</a> |
                                <a href="SectionUnderConstructionPage.html">Sidebar</a> |
                                <a href="SectionUnderConstructionPage.html">Contact</a> |
                                <b><a href="SignUp.html">Sign up</a></b>
                            </p>
                        </div>
                    </div>

                    <div class="col-md-6 widget">
                        <div class="widget-body">
                            <p class="text-right">
                                Copyright &copy; 2016, The Traveler Bulgaria. Designed by David & Yasen</a> 
                            </p>
                        </div>
                    </div>

                </div> <!-- /row of widgets -->
            </div>
        </div>
		</footer>	
		




	<!-- JavaScript libs are placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
	<script src="assets/js/headroom.min.js"></script>
	<script src="assets/js/jQuery.headroom.min.js"></script>
	<script src="assets/js/template.js"></script>
	<script src="assets/js/PictureValidate.js"></script>
	<script src="http://malsup.github.com/jquery.form.js"></script> 
	<script src="assets/js/checkForUser.js"></script>
	<script>checkIfLoggedIn()</script>
	<!-- Google Maps -->
	
	

</body>
<script>
function add(){
	var form = $("#addDestForm");
	if(!Validate(form)){
		return;
	}
	form.ajaxSubmit({
		type : 'post',
		url : 'addDestination',
		async: true,
		success : function(results){
			if(results!=null && results != ""){
				showMessage(results);					
				
			}else{
				alert("Some error occured, try again.");
			}
		}
	})
}
	
function showMessage(results){
	var msg = JSON.parse(result).msg;
      if(msg == 'Destination added successfully!'){
          $('#message').html("<font color='green'>Destination successfully added. </font>");
          setTimeout(function(){
			window.location.href = "AllDestinations.html";
		}, 500)
      }else if(msg == 'Wrong data!'){
          $('#message').html("<font color='red'>Incorrect data! </font>");
      }else if(msg == 'EXISTS'){
    	  $('#message').html("<font color='red'>Destination already exists! </font>");
      }else if(msg == 'Destination registration failed!'){
    	  $('#message').html("<font color='red'>Destination registration failed! </font>");
      }else if(msg == 'Wrong picture format!'){
    	  $('#message').html("<font color='red'>Incorrect picture format! Only .jpg, .jpeg, .bmp, .gif and .png are supported! </font>");
      }
 }
</script>
</html>



<cfoutput>
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyBQKyIgPewrgRCgagA1sDItFSRZh5hZlL4&sensor=false"></script>
</cfoutput>

<script type="text/javascript">
//<![CDATA[

    // global "map" variable
    var map = null;
    var marker = null;

    // popup window for pin, if in use
    var infowindow = new google.maps.InfoWindow({ 
        size: new google.maps.Size(150,50)
        });

    // A function to create the marker and set up the event window function 
    function createMarker(latlng, name, html) {

    var contentString = html;

    var marker = new google.maps.Marker({
        position: latlng,
        map: map,
        zIndex: Math.round(latlng.lat()*-100000)<<5
        });

    google.maps.event.addListener(marker, 'click', function() {
        infowindow.setContent(contentString); 
        infowindow.open(map,marker);
        });

    google.maps.event.trigger(marker, 'click');    
    return marker;

}

function initialize() {

    
    var myLatlng = new google.maps.LatLng(42.70,23.33);

    
    var myOptions = {
        zoom: 8,
        center: myLatlng,
        mapTypeControl: true,
        mapTypeControlOptions: {style: google.maps.MapTypeControlStyle.DROPDOWN_MENU},
        navigationControl: true,
    }

    map = new google.maps.Map(document.getElementById("map"), myOptions);

    
      
    marker = new google.maps.Marker({
      position: myLatlng,
      map: map,
      
      
    });

    
    formlat = document.getElementById("lattitude").value = myLatlng.lat();
    formlng = document.getElementById("longitude").value = myLatlng.lng();

    
    google.maps.event.addListener(map, 'click', function() {
        infowindow.close();
        });

   
    google.maps.event.addListener(map, 'click', function(event) {
        
         if (marker) {
            marker.setMap(null);
            marker = null;
         }        

       
        var myLatLng = event.latLng ;
       
        marker = new google.maps.Marker({   
            position: myLatLng,
            map: map,       
           
        });
            marker.setMap(map);
        
        formlat = document.getElementById("lattitude").value = event.latLng.lat();
        formlng = document.getElementById("longitude").value = event.latLng.lng();

    });

}

function add(){
	var form = $("#addDestForm");
	form.ajaxSubmit({
		type : 'post',
		url : 'addDestination',
		async: true,
		success : function(results){
			if(results!=null && results != ""){
				showMessage(results);	
			}else{
				alert("Some error occured, try again.");
			}
		}
	})
}
	
function showMessage(results){
	var msg = JSON.parse(results).msg;
      if(msg == 'Destination added successfully!'){
          $('#message').html("<font color='green'>Destination successfully added. </font>");
          setTimeout(function(){
			window.location.href = "AllDestinations.html";
		}, 500)
      }else if(msg == 'Destination registration failed!'){
          $('#message').html("<font color='red'>An error occured, try again. </font>");
      }else if(msg == 'EXISTS'){
    	  $('#message').html("<font color='red'>Destination already exists! </font>");
      }else if(msg == 'Wrong data!'){
          $('#message').html("<font color='red'>Incorrect data! </font>");
      }else if(msg == 'Wrong picture format!'){
    	  $('#message').html("<font color='red'>Wrong picture format! Only .jpg, .jpeg, .bmp, .gif and .png are supported! </font>");
      }
 }
//]]>

</script> 